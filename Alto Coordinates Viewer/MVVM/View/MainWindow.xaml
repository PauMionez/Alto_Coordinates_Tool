<ui:FluentWindow x:Class="Alto_Coordinates_Viewer.MVVM.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Alto_Coordinates_Viewer"
                  xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                  xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
                  xmlns:vm="clr-namespace:Alto_Coordinates_Viewer.MVVM.ViewModel"
                  xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
                  xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
        mc:Ignorable="d"
        Background="{ui:ThemeResource}"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" WindowState="Maximized" Height="450" Width="800">
    
    
    <ui:FluentWindow.DataContext>
        <vm:MainViewModel />
    </ui:FluentWindow.DataContext>

    <ui:FluentWindow.InputBindings>
        <KeyBinding Gesture="Ctrl+s" Command="{Binding SaveUpdateXmlFileCommand}" />
    </ui:FluentWindow.InputBindings>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>


        <ui:TitleBar Title="{Binding Path=Title}" Grid.Row="0" Grid.ColumnSpan="2"/>
        <ui:CardExpander Grid.Row="1" Grid.ColumnSpan="2" Margin="10" Padding="10" ContentPadding="0" Header="MENU">
            <ui:CardExpander.Content>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <!-- Buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <ui:Button Content="Select Alto Xml"
                               Command="{Binding SelectAltoFilesCommand}"
                               Margin="5"
                               Foreground="White"
                               FontWeight="Bold"
                               BorderBrush="#00FFFF" >
                            <ui:Button.Effect>
                                <DropShadowEffect Color="#00FFFF"
                                  BlurRadius="15"
                                  ShadowDepth="0"
                                  Opacity="1"/>
                            </ui:Button.Effect>
                        </ui:Button>
                        <ui:Button Content="Select Image" 
                                Command="{Binding SelectImageFilesCommand}" 
                                Margin="5" 
                                Foreground="White"
                                FontWeight="Bold"
                                BorderBrush="#00FFFF">
                            <ui:Button.Effect>
                                <DropShadowEffect Color="#00FFFF"
                                  BlurRadius="15"
                                  ShadowDepth="0"
                                  Opacity="1"/>
                            </ui:Button.Effect>
                        </ui:Button>
                    </StackPanel>
                </Grid>
            </ui:CardExpander.Content>
        </ui:CardExpander>

        
        <!--Viewer-->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!--XML Viewer-->
            <TextBlock Text="Xml Coding Entry" Margin="60 1 0 0" FontSize="12" Foreground="White"/>
            <avalonEdit:TextEditor Name="avalonTextEditor" SyntaxHighlighting="XML" FontFamily="Consolas" 
                                   FontSize="{Binding XmlTextFontSize}" WordWrap="True" Margin="30 20 20 20" 
                                   Document="{Binding CodingTxtDocument, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                   VirtualizingPanel.IsVirtualizing="True" ShowLineNumbers="True" Background="White" >
                <dx:Interaction.Behaviors>
                    <dx:EventToCommand EventName="Loaded" Command="{Binding AvalonTextEditor_LoadedCommand}" CommandParameter="{Binding ElementName=avalonTextEditor}"/>
                    <dx:EventToCommand EventName="PreviewMouseWheel" Command="{Binding ZoomXmlTextViewerCommand}" PassEventArgsToCommand="True"/>
                    <dx:EventToCommand EventName="TextChanged" Command="{Binding XmlTextChangedCommand}"/>
                    <dx:EventToCommand EventName="PreviewMouseUp" Command="{Binding AvalonTextSelectionChangedCommand}" />
                </dx:Interaction.Behaviors>
            </avalonEdit:TextEditor>


            <TextBlock Grid.Column="1" Text="Image Viewer" Margin="60 1 0 0" FontSize="12" Foreground="White"/>
            <StackPanel Background="White" Grid.Column="1"  Margin="30 20 20 20">
                <!--<ScrollViewer Name="scrollViewerControl" Grid.Column="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" >
                    <Image Grid.Column="1" x:Name="image" Source="{Binding SelectedImageSource}" Stretch="Uniform" CacheMode="BitmapCache" Margin="30 20 20 20" />
                </ScrollViewer>-->
                <Grid>
                    <ScrollViewer >
                        <Grid>
                            <Image x:Name="DocumentImage" Source="{Binding SelectedImageSource}" Stretch="Uniform" HorizontalAlignment="Left" VerticalAlignment="Top">
                                <dx:Interaction.Behaviors>
                                    <dx:EventToCommand EventName="SizeChanged"
                                                       Command="{Binding ImageSizeChangedCommand}"
                                                       PassEventArgsToCommand="True"/>
                                </dx:Interaction.Behaviors>
                            </Image>
                            <Canvas x:Name="OverlayCanvas"
                                        IsHitTestVisible="False"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Width="{Binding RenderedImageWidth}"
                                        Height="{Binding RenderedImageHeight}">
                                <ItemsControl ItemsSource="{Binding AltoCollection}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemContainerStyle>
                                        <Style>
                                            <Setter Property="Canvas.Left" Value="{Binding ScaledX}" />
                                            <Setter Property="Canvas.Top" Value="{Binding ScaledY}" />
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Rectangle Stroke="{Binding ColorBox}"
                                                       StrokeThickness="1"
                                                       Width="{Binding ScaledWidth}"
                                                       Height="{Binding ScaledHeight}"
                                                       Fill="Transparent">
                                            </Rectangle>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Canvas>
                        </Grid>
                    </ScrollViewer>
                </Grid>


            </StackPanel>

        </Grid>
    </Grid>
</ui:FluentWindow>
